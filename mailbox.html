<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Há»™p ThÆ° Cá»§a Em ğŸ’Œ</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/mailbox.css">
    <link rel="stylesheet" href="css/sunset-theme.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="icon" type="image/png" href="./images/logo.svg">
</head>
<body>
    <!-- Floating Hearts Animation -->
    <div class="floating-hearts" id="floating-hearts"></div>
    
    <div class="mailbox-container">
        <!-- Stitch decorations -->
        <div class="stitch-decoration"></div>
        <div class="stitch-decoration"></div>
        <div class="stitch-decoration"></div>
        
        <a href="#" id="back-to-dashboard-btn" class="back-to-dashboard-btn">â†© Quay láº¡i</a>
        
        <div class="mailbox-header">
            <h1>ğŸ’Œ Há»™p ThÆ° Cá»§a Em</h1>
            <p class="mailbox-subtitle">Nhá»¯ng lá»i nháº¯n yÃªu thÆ°Æ¡ng tá»« anh ğŸ’•</p>
        </div>

        <div id="mailbox-content" class="mailbox-content">
            <div class="loading-message">
                <div class="loading-spinner"></div>
                <p>Äang táº£i thÆ°...</p>
            </div>
            <div class="scroll-fade-bottom"></div>
        </div>

        <div class="mailbox-footer">
            <button id="refresh-mailbox-btn" class="refresh-btn">
                ğŸ”„ LÃ m má»›i há»™p thÆ°
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/realtime-sync.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/mailbox.js"></script>
    <script src="js/floating-hearts.js"></script>

    <script>
        // Inline initialization for mailbox page
        window.addEventListener('DOMContentLoaded', async () => {
            if (typeof db === 'undefined') {
                console.error("Firebase chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o!");
                return;
            }

            // Äá»£i realtime sync khá»Ÿi táº¡o
            const waitForRealtimeSync = () => {
                return new Promise((resolve) => {
                    const check = () => {
                        if (window.realtimeSync && window.realtimeSync.isInitialized) {
                            resolve();
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    check();
                });
            };

            try {
                await waitForRealtimeSync();
                
                // Khá»Ÿi táº¡o há»™p thÆ°
                initializeMailbox();

                // Thiáº¿t láº­p Ä‘á»“ng bá»™ thá»i gian thá»±c cho há»™p thÆ°
                // console.log('ğŸ”„ Thiáº¿t láº­p Ä‘á»“ng bá»™ thá»i gian thá»±c cho há»™p thÆ°...');
                
                window.realtimeSync.listenToHisData((hisData) => {
                    // console.log('ğŸ“¨ Há»™p thÆ° Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t theo thá»i gian thá»±c');
                    updateMailbox(hisData.notesForHer || []);
                });

                // console.log('âœ… Äá»“ng bá»™ thá»i gian thá»±c cho há»™p thÆ° Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p!');

            } catch (error) {
                console.error("Lá»—i khi thiáº¿t láº­p Ä‘á»“ng bá»™ thá»i gian thá»±c:", error);
                showError("ÄÃ£ xáº£y ra lá»—i khi káº¿t ná»‘i.");
            }
        });
    </script>
</body>
</html>
